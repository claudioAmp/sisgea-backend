<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ob.unibanca.sicf.consultasgenerales.mapper.ICompensacionMapper">
	
	<!-- CONSULTA DEL LOG CONTABLE GENERAL PARA LA GRILLA -->
	
	<sql id="consultaCompensacion" >
		SELECT *
		FROM VIE_CON_COMPENSACION a
	</sql>
	
	<sql id = "fragmentoWhere">
		<if  test="fechaProcesoInicio != null and fechaProcesoFin != null">
			 a.FECHA_PROCESO BETWEEN #{fechaProcesoInicio}  AND #{fechaProcesoFin}
		</if>
		<if  test="idSecuencia != null and idSecuencia != '' and idSecuencia != -1">
			 AND a.ID_SECUENCIA = #{idSecuencia}
		</if>
		<if  test="numeroTarjeta != null and numeroTarjeta !=''">
			 AND a.NUMERO_TARJETA LIKE #{numeroTarjeta}
		</if>
		
		<if  test="valorCompensacion != null and valorCompensacion != -1">
			 AND a.VALOR_COMPENSACION = #{valorCompensacion}
		</if>
		<if  test="numeroTrace != null and numeroTrace != ''">
			 AND a.NUMERO_TRACE = #{numeroTrace}
		</if>
	</sql>
	
	<sql id ="fragmentoWhereMultiples">
		<if test="membresias !=null and membresias.size()>0">
			AND a.ID_MEMBRESIA IN 
			<foreach item="item" index="index" collection="membresias" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="servicios !=null and servicios.size()>0">
			AND a.ID_SERVICIO IN 
			<foreach item="item" index="index" collection="servicios" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="origenes !=null and origenes.size()>0">
			AND a.ID_ORIGEN IN 
			<foreach item="item" index="index" collection="origenes" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="clasesTransaccion !=null and clasesTransaccion.size()>0">
			AND a.ID_CLASE_TRANSACCION IN 
			<foreach item="item" index="index" collection="clasesTransaccion" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="codigosTransaccion !=null and codigosTransaccion.size()>0">
			AND a.ID_CODIGO_TRANSACCION IN 
			<foreach item="item" index="index" collection="codigosTransaccion" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="roles !=null and roles.size()>0">
			AND a.ID_ROL IN 
			<foreach item="item" index="index" collection="roles" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="canales !=null and canales.size()>0">
			AND a.ID_CANAL IN 
			<foreach item="item" index="index" collection="canales" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="instituciones !=null and instituciones.size()>0">
			AND a.ID_INSTITUCION_EMISORA IN 
			<foreach item="item" index="index" collection="instituciones" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="institucionesReceptoras !=null and institucionesReceptoras.size()>0">
			AND a.ID_INSTITUCION_RECEPTORA IN 
			<foreach item="item" index="index" collection="institucionesReceptoras" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="bines !=null and bines.size()>0">
			AND a.BIN IN 
			<foreach item="item" index="index" collection="bines" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="codigosRespuesta !=null and codigosRespuesta.size()>0">
			AND a.CODIGO_RESPUESTA IN 
			<foreach item="item" index="index" collection="codigosRespuesta" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="monedasCompensacion !=null and monedasCompensacion.size()>0">
			AND a.ID_MONEDA_COMPENSACION IN 
			<foreach item="item" index="index" collection="monedasCompensacion" open ="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
	</sql>
	
	<select id="buscarPorCriterios" parameterType="CriterioBusquedaCompensacion"  resultType="Compensacion" statementType="PREPARED">	
		<include refid="consultaCompensacion" />
			WHERE
		<include refid="fragmentoWhere"/> 
		<include refid="fragmentoWhereMultiples"/>
   	</select>
   	
   	
   	<!-- CONSULTA DEL LOG CONTABLE GENERAL PARA EL DETALLE -->
     	
   	<sql id="consultaCompensacionDetalle" >
		SELECT *
		FROM VIE_CON_COMPENSACION_DETALLE a
	</sql>
	
	<sql id = "fragmentoWhereDetalle">
		<if  test="idSecuencia != null">
			  a.ID_SECUENCIA = #{idSecuencia}
		</if>
		<if  test="fechaProcesoInicio != null and fechaProcesoFin != null">
			 AND a.FECHA_PROCESO BETWEEN #{fechaProcesoInicio}  AND #{fechaProcesoFin}
		</if>
		
	</sql>
	
	<select id="buscarPorSecuencia" parameterType="CriterioBusquedaCompensacion"  resultType="CompensacionDetalle" statementType="PREPARED">	
		<include refid="consultaCompensacionDetalle" />
			WHERE
		<include refid="fragmentoWhereDetalle"/>
   	</select>
   	
   	
	<select id="buscarComisionesPorSecuencia" parameterType="CriterioBusquedaCompensacion"  resultType="ComisCompensacion" statementType="PREPARED">	
		SELECT *
		FROM VIE_CON_COMPENSACION_COMISION a
			WHERE
		<if  test="idSecuencia != null">
			  a.ID_SECUENCIA = #{idSecuencia}
		</if>
   	</select>

</mapper>