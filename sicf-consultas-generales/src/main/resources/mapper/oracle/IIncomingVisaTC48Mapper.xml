<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ob.unibanca.sicf.consultasgenerales.mapper.IIncomingVisaTC48Mapper">
			
	<sql id="consultaPorCriteriosTCR0" >
		SELECT *
		FROM VIE_CON_MOV_INC_TC48 a
	</sql>
	
	<sql id = "fragmentoWhereGet" >
		<if  test="fechaProcesoInicio != null and fechaProcesoFin != null">
			 a.FECHA_PROCESO BETWEEN #{fechaProcesoInicio}  AND #{fechaProcesoFin}
		</if>
		<if  test="fechaTransaccionInicio != null and fechaTransaccionFin != null and fechaTransaccionInicio != '' and fechaTransaccionFin != ''">
			 AND a.TRANSACTION_DATE BETWEEN #{fechaTransaccionInicio}  AND #{fechaTransaccionFin}
		</if>
		<if  test="accountNumber != null and accountNumber != ''">
			 AND a.ACCOUNT_NUMBER = #{accountNumber}
		</if>
	</sql>
	
	<sql id ="fragmentoWhereGetMultiples" >
		<if  test="standInReasonsCodes != null and standInReasonsCodes.size()>0" >
			AND a.STAND_IN_REASON_CODE IN 
				<foreach item="item" index="index" collection="standInReasonsCodes" open ="(" separator=","  close=")">
					#{item}
				</foreach>
		</if>
		<if  test="responsesCodes != null and responsesCodes.size()>0" >
			AND a.TRANSACTION_CODE IN 
				<foreach item="item" index="index" collection="responsesCodes" open ="(" separator=","  close=")">
					#{item}
				</foreach>
		</if>
		<if  test="merchantTypes != null and merchantTypes.size()>0" >
			AND a.MERCHANT_TYPE IN 
				<foreach item="item" index="index" collection="merchantTypes" open ="(" separator=","  close=")">
					#{item}
				</foreach>
		</if>
	</sql>
	
	<sql id = "fragmentoFiltrosOrdenaciones">
		<if  test="filtroFechaProceso != null " >
			AND FECHA_PROCESO = #{filtroFechaProceso}
		</if>
		<if  test="filtroSecuenciaIncoming != null " >
			<bind name="pFiltroSecuenciaIncoming" value="'%' + filtroSecuenciaIncoming + '%'" />
			AND SECUENCIA_INCOMING LIKE #{pFiltroSecuenciaIncoming}
		</if>
		<if  test="filtroDestinationBin != null " >
			<bind name="pFiltroDestinationBin" value="'%' + filtroDestinationBin + '%'" />
			AND DESTINATION_BIN LIKE #{pFiltroDestinationBin}
		</if>
		<if  test="filtroSourceBin != null " >
			<bind name="pFiltroSourceBin" value="'%' + filtroSourceBin + '%'" />
			AND SOURCE_BIN #{pFiltroSourceBin}
		</if>
		<if  test="filtroAccountNumber != null " >
			<bind name="pFiltroAccountNumber" value="'%' + filtroAccountNumber + '%'" />
			AND ACCOUNT_NUMBER #{pFiltroAccountNumber}
		</if>
		<if  test="filtroResponseCode != null " >
			<bind name="pFiltroResponseCode" value="'%' + filtroResponseCode + '%'" />
			AND RESPONSE_CODE #{pFiltroResponseCode}
		</if>
		<if  test="filtroTransactionAmount != null " >
			<bind name="pFiltroTransactionAmount" value="'%' + filtroTransactionAmount + '%'" />
			AND TRANSACTION_AMOUNT #{pFiltroTransactionAmount}
		</if>
		<if  test="filtroTransmissionDateTime != null " >
			<bind name="pFiltroTransmissionDateTime" value="'%' + filtroTransmissionDateTime + '%'" />
			AND TRANSMISSION_DATE_TIME #{pFiltroTransmissionDateTime}
		</if>
		<if  test="filtroTransactionTime != null " >
			<bind name="pFiltroTransactionTime" value="'%' + filtroTransactionTime + '%'" />
			AND TRANSACTION_TIME #{pFiltroTransactionTime}
		</if>
		<if  test="ordenFechaProceso != null " >
		ORDER BY
			FECHA_PROCESO  ${ordenFechaProceso}
		</if>
		<if  test="ordenSecuenciaIncoming != null " >
		ORDER BY
			SECUENCIA_INCOMING  ${ordenSecuenciaIncoming}
		</if>
		<if  test="ordenDestinationBin != null " >
		ORDER BY
			DESTINATION_BIN  ${ordenDestinationBin}
		</if>
		<if  test="ordenSourceBin != null " >
		ORDER BY
			SOURCE_BIN  ${ordenSourceBin}
		</if>
		<if  test="ordenAccountNumber != null " >
		ORDER BY
			ACCOUNT_NUMBER  ${ordenAccountNumber}
		</if>
		<if  test="ordenResponseCode != null " >
		ORDER BY
			RESPONSE_CODE  ${ordenResponseCode}
		</if>
		<if  test="ordenTransactionAmount != null " >
		ORDER BY
			TRANSACTION_AMOUNT  ${ordenTransactionAmount}
		</if>
		<if  test="ordenTransmissionDateTime != null " >
		ORDER BY
			TRANSMISSION_DATE_TIME  ${ordenTransmissionDateTime}
		</if>
		<if  test="ordenTransactionTime != null " >
		ORDER BY
			TRANSACTION_TIME  ${ordenTransactionTime}
		</if>
	</sql>
	
	<select id="buscarPorCriterios" parameterType="CriterioBusquedaIncomingVisaTC48"  resultType="IncomingVisaTC48" statementType="PREPARED">	
		<include refid="consultaPorCriteriosTCR0" />
		<where>
			<include refid="fragmentoWhereGet" /> 
			<include refid="fragmentoWhereGetMultiples" />
			<include refid="fragmentoFiltrosOrdenaciones" />
		</where>	
   	</select>
     
	 
	<select id="buscarPorIdSecuenciaTCR0" parameterType="CriterioBusquedaIncomingVisa" resultType="IncomingVisaTC48TCR0" statementType="PREPARED">		
		SELECT 
			*
		FROM VIE_CON_MOV_INC_TC48_TCR0 a
  		<where>
	  		<if  test="idSecuenciaIncoming != null and fechaProceso != '' " >
				SECUENCIA_INCOMING = #{idSecuenciaIncoming} AND FECHA_PROCESO = #{fechaProceso}
			</if>
  		</where>	
   	</select>
	
   	 <select id="buscarPorIdSecuenciaTCR1" parameterType="CriterioBusquedaIncomingVisa" resultType="IncomingVisaTC48TCR1" statementType="PREPARED">		
		SELECT 
			*
		FROM VIE_CON_MOV_INC_TC48_TCR1 a
  		<where>
	  		<if  test="idSecuenciaIncoming != null and fechaProceso != '' " >
				SECUENCIA_INCOMING = #{idSecuenciaIncoming} AND FECHA_PROCESO = #{fechaProceso}
			</if>
  		</where>
   	</select>
	
</mapper>
