<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.taller.sisgea.generadorconsultas.mapper.IReportePrioridadMapper">

	<sql id="consultaVistaMant">
       SELECT 
             ID_QUERY_USUA	AS ID_QUERY_USUA,
	         USERNAME 			AS USUARIO,
	         ID_QUERY 		AS ID_REPORTE,
	         PRIORIDAD 			AS PRIORIDAD
       FROM MOV_QUERY_USUARIO
    </sql>

    <select id="buscarTodos" resultType="ReportePrioridad" statementType="PREPARED">
        <include refid="consultaVistaMant"/>
    </select>
    
    <select id="buscarPorCriterios" resultType="ReportePrioridad" parameterType="CriterioBusquedaReportePrioridad" statementType="PREPARED">
        <include refid="consultaVistaMant"/>
       <where>
	        <if  test=" usuario != null and usuario != '' " >
	       	  AND USERNAME = #{usuario}
	        </if>
	       	<if  test=" idReporte!=null and idReporte!=0">
	       	  AND ID_QUERY = #{idReporte}
	        </if>
       </where>
       ORDER BY ID_QUERY ASC
    </select>
    
    <select id="mantener" parameterType="ParametroMantenimiento" statementType="CALLABLE">
        {
            CALL PKG_MAN_REP.prc_man_rep_query_usuario(
                #{modo, 						  jdbcType=VARCHAR, mode=IN},
                #{objetoMantenido.idQueryUsua,    jdbcType=INTEGER, mode=INOUT},
                #{objetoMantenido.idReporte,      jdbcType=INTEGER, mode=IN},
                #{objetoMantenido.usuario,        jdbcType=VARCHAR, mode=IN},
                #{objetoMantenido.prioridad, 	  jdbcType=INTEGER, mode=IN},
                #{usuario, 						  jdbcType=VARCHAR, mode=IN}
            )
        }
    </select>

</mapper>
